# 13.2 用户代理检测

在 JavaScript 可以通过 `navigator.userAgent` 访问到浏览器的用户代理字符串。HTTP 请求头中也包含用户代理字符串。

## 13.2.1 用户代理的历史

HTTP(1.0 和 1.1) 要求浏览器应该向服务器发送包含浏览器名称和版本信息的简短字符串（RFC 2616，HTTP1.1）。

## 13.2.2 浏览器分析

能力检测不用理会浏览器而正常执行。用户代理字符串是有规律可循的，我们利用它能够识别浏览器和操作系统信息。

### 1. 伪造用户代理

通过检测用户代理来识别浏览器并不是完美的方式，毕竟这个字符串可以造假。在浏览器中 `navigator.userAgent` 是只读属性，直接修改是无效的。但是有些浏览器提供了 `__defineGetter__` 方法，可以篡改用户代理字符串；

```js
window.navigator.__defineGetter__("userAgent", () => "foobar");
```

如果相信浏览器返回的用户代理字符串，就用它判断浏览器。如果怀疑脚本或浏览器可能篡改这个值，那最好还是使用能力检测。

### 2. 分析浏览器

通过解析浏览器返回的用户代理字符串，可以极其精确推断出下列环境信息：

- 浏览器
- 浏览器版本
- 浏览器渲染引擎
- 设备类型（桌面/移动）
- 设备生产商
- 设备型号
- 操作系统
- 操作系统版本

当然这些随着产品更新也会随之变化的，因此解析程序也需要更新维护，维护比较频繁 github 库推荐有：

- Bowser
- UAParser.js
