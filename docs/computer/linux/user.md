# Linux 用户和用户组管理

无论是 windows、macos、linux 均采用多用户的管理模式进行权限管理。

## 用户和用户组

- Linux 系统中，拥有最大权限的账号名是：root（超级系统管理员）；
- Linux 系统权限管控级别有 2 种，分别是：
  - 针对用户的权限控制；
  - 针对用户组的权限控制；

### 用户和用户组关系

- 一对一，一个用户可以存在一个组中，是组中的唯一用户；
- 一对多，一个用户可以在多个组中，此用户具有这多个组的共同权限；
- 多对一，多个用户可以在一个组中，这些用户具有和组相同的权限；
- 多对多，多个用户可以在多个组中；

### 系统用户配置文件

- `/ect/passwd`，存储了系统中所有用户的基本信息；
- `/etc/shadow`，用于存储 Linux 系统中用户的密码信息，又称为“影子文件”；
- `/ect/group`，用户组的所有信息都存放在此文件中；
- `/etc/gshadow`，存储组用户的密码信息；

## 用户切换 su 命令

Switch User，通过 su 命令可实现任何身份的切换，包括普通用户切换为 root 用户，从 root 用户切换为普通用户，以及普通用户之间的切换。

### 命令格式

`su [选项] 用户名`

切换用户后，可以通过 `exit` 命令退回上一个用户，也可以使用快捷键 `CTRL+d`。

### 选项参数

- `-`，符号是可选的，表示是否在切换用户后加载环境变量（包括 PATH 变量、MAIL 变量等）;

## 临时授权 sudo 命令

该命令为普通命令授权，临时以 root 身份执行。需注意的并不是所有的用户，都有权利使用 sudo，需要为普通用户配置 sudo 认证；

### 语法格式

`sudo 其他命令`

### 为普通用户配置 sudo 认证

- 切换到 root 用户，执行 `vi sudo` 命令，会自动通过 vi 编辑器打开 `/etc/sudoers`。
- 在文件的最后添加 `user ALL=(ALL) NOPASSWD:ALL` ，其中 `NOPASSWD:ALL` 表示使用 sudo 命令时，无需输入密码。
- 最后 `wq` 退出编辑。

## 创建用户组 groupadd 命令

### 命令格式

`groupadd [选项] 组名`

### 选项参数

- `-g GID`，指定组 ID；
- `-r`，创建系统群组；

## 修改用户组 groupmod 命令

### 命令格式

`groupmod [选项] 组名`

### 选项参数

- `-g GID`，修改组 ID；
- `-n 新组名`，修改组名；

## 删除用户组 groupdel 命令

使用 groupdel 命令删除群组，其实就是删除 `/etc/group` 文件和`/etc/gshadow`文件中有关的目标群组的数据信息。

### 命令格式

`groupdel 组名`

> 注意，不能使用 groupdel 命令随意删除群组。此命令仅适用于删除那些 "不是任何用户初始组" 的群组，换句话说，如果有群组还是某用户的初始群组，则无法使用 groupdel 命令成功删除。

## 添加用户 useradd 命令

### 命令格式

`useradd [选项] 用户ming`

### 选项参数

- `-u UID`，指定用户的 UID，该值范围不要小于 500；
- `-d 目录`，指定用户的主目录，不指定一般默认在 `/home/用户名`，主目录必须写绝对路径，需注意权限；
- `-g 用户组`，指定用户初始的用户组，一般以和用户名相同组作为用户的初始组，在创建用户是默认创建初始组；
- `-G 用户组`，指定用户的附加组；

## 修改用户 usermod 命令

### 命令格式

`usermod [选项] 用户名`

### 选项参数

- `-d 目录`，修改用户的主目录，即修改 `/etc/passwd` 文件中的目标信息；
- `-g 组名`，修改用户的初始组，即修改 `/etc/passwd` 文件目标用户信息（GID）；
- `-u UID`，修改用户的 UID，即修改 `/etc/passwd` 文件目标用户信息（UID）；
- `-G 组名`，修改用户的附加组，其实就是把用户加入其他用户组，即修改 /etc/group 文件；
- `-l 用户名`，修改用户名称；
- `-L`，临时锁定用户（Lock）；
- `-U`，解锁用户（Unlock）；

## 删除用户 userdel 命令

### 命令格式

`userdel [-r] 用户名`

-r 选项表示在删除用户的同时删除用户的家目录。

## 查看用户/用户组 id 命令

id 命令可以查询用户的 UID、GID 和附加组的信息

### 命令格式

`id 用户名`

## 用户加入/移除用户组 gpasswd 命令

### 命令格式

`gpasswd 选项 组名`

## 其他命令

### whoami
